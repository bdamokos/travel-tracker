@import 'tailwindcss';

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

:root {
  --foreground-rgb: 0, 0, 0;
  --background-start-rgb: 255, 255, 255;
  --background-end-rgb: 255, 255, 255;
  --foreground: 0, 0, 0;
  --background: 255, 255, 255;
  --travel-marker-color-past: #4A6FA5;
  --travel-marker-color-present: #2FB7A4;
  --travel-marker-color-future: #F28C52;
  --travel-marker-saturation-step-0: 0.05;
  --travel-marker-saturation-step-1: 0.17;
  --travel-marker-saturation-step-2: 0.32;
  --travel-marker-saturation-step-3: 0.49;
  --travel-marker-saturation-step-4: 0.67;
  --travel-marker-saturation-step-5: 0.86;
  --travel-marker-saturation-step-6: 1.06;
  --travel-marker-saturation-step-7: 1.27;
  --travel-marker-saturation-step-8: 1.48;
  --travel-marker-saturation-step-9: 1.70;
  --travel-marker-highlight-saturation: 1.25;
  --travel-marker-highlight-brightness: 1.08;
  --travel-marker-debug-buckets: 0;
  --travel-marker-focus-ring-color: #2563eb;
  --travel-marker-focus-ring-secondary: #fff;
  --travel-marker-badge-cluster-bg: #ef4444;
  --travel-marker-badge-visit-bg: #7c3aed;
  --travel-marker-badge-visit-shadow-color: rgb(15 23 42 / 35%);
}

@media (prefers-color-scheme: dark) {
  :root {
    --foreground-rgb: 255, 255, 255;
    --background-start-rgb: 0, 0, 0;
    --background-end-rgb: 0, 0, 0;
    --foreground: 255, 255, 255;
    --background: 0, 0, 0;
    --travel-marker-focus-ring-color: #60a5fa;
    --travel-marker-focus-ring-secondary: #1f2937;
  }
}

body {
  color: rgb(var(--foreground-rgb));
  background: linear-gradient(
      to bottom,
      transparent,
      rgb(var(--background-end-rgb))
    )
    rgb(var(--background-start-rgb));
}

/* Make sure the map container takes full height */
.leaflet-container {
  width: 100%;
  height: 100%;
  min-height: 400px;
  /* Set a reasonable z-index that won't interfere with our UI components */
  z-index: 10;
}

.leaflet-container [data-travel-marker-bucket]::after {
  content: attr(data-travel-marker-bucket);
  position: absolute;
  left: -6px;
  bottom: -6px;
  width: 16px;
  height: 16px;
  border-radius: 9999px;
  background: rgba(17, 24, 39, 0.8);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  pointer-events: none;
  opacity: var(--travel-marker-debug-buckets, 0);
}


.travel-marker-count-badge {
  position: absolute;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  border: 2px solid white;
  pointer-events: none;
}

.travel-marker-count-badge-cluster {
  right: -6px;
  top: -6px;
  border-radius: 9999px;
  background: var(--travel-marker-badge-cluster-bg);
}

.travel-marker-count-badge-visit {
  left: -7px;
  bottom: 6px;
  border-radius: 6px;
  background: var(--travel-marker-badge-visit-bg);
  box-shadow: 0 1px 3px var(--travel-marker-badge-visit-shadow-color);
}

.travel-marker-interactive {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  outline: none;
  cursor: pointer;
  background: transparent;
  border: 0;
  padding: 0;
  margin: 0;
  appearance: none;
}

.travel-marker-interactive:focus-visible {
  outline: 3px solid var(--travel-marker-focus-ring-color);
  outline-offset: 2px;
  border-radius: 9999px;
  box-shadow: 0 0 0 5px var(--travel-marker-focus-ring-secondary),
              0 0 0 8px var(--travel-marker-focus-ring-color);
}

.travel-marker-interactive:focus-visible .travel-marker-visual {
  transform: scale(1.05);
}

.travel-marker-collapse .travel-marker-group,
.travel-marker-collapse .travel-marker-visual {
  opacity: 0;
}

.travel-marker-collapse:focus-visible .travel-marker-group,
.travel-marker-collapse:focus-visible .travel-marker-visual {
  opacity: 1;
}

/* Set z-index for Leaflet popups that should appear over the map but below our modals */
.leaflet-popup {
  z-index: 20;
}

/* All leaflet controls should be accessible but below our modals */
.leaflet-control {
  z-index: 20;
}

/* Custom styles for our components */
.transport-icon {
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Custom highlighted marker styling */
.custom-highlighted-marker {
  z-index: 1000;
}

.custom-highlighted-marker div {
  animation: pulse-marker 2s infinite;
}

@keyframes pulse-marker {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .flex-col-mobile {
    flex-direction: column;
  }

  .w-full-mobile {
    width: 100%;
  }

  .h-half-mobile {
    height: 50vh;
  }
}

/* Animation for sync indicator */
@keyframes pulse {
  0% {
    transform: scale(0.95);
    opacity: 0.7;
  }
  70% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.95);
    opacity: 0.7;
  }
}

.pulse-animation {
  animation: pulse 2s infinite;
}

/* Make the app feel more app-like on mobile */
@media (display-mode: standalone) {
  body {
    overscroll-behavior-y: none;
  }

  /* Add padding to account for iOS home indicator */
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* Line clamp utilities */
.line-clamp-3 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
  line-clamp: 3;
}

/* Dark mode Leaflet popup styling */
@media (prefers-color-scheme: dark) {
  .leaflet-popup-content-wrapper {
    background: #374151 !important;
    color: #f9fafb !important;
    border: 1px solid #4b5563 !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  .leaflet-popup-content {
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.4 !important;
  }

  .leaflet-popup-tip {
    background: #374151 !important;
    border: 1px solid #4b5563 !important;
  }

  .leaflet-container a {
    color: #60a5fa !important;
  }
}

/* General Leaflet popup optimization for both light and dark modes */
.leaflet-popup-content-wrapper {
  padding: 0 !important;
}

.leaflet-popup-content {
  margin: 0 !important;
  padding: 0 !important;
  line-height: 1.4 !important;
}

/* Layer control legend styling */
.leaflet-control-layers {
  background: white !important;
  border-radius: 8px !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
  padding: 8px 12px !important;
  max-width: 280px !important;
}

.leaflet-control-layers-list {
  padding: 4px 0 !important;
}

.leaflet-control-layers-overlays {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.leaflet-control-layers-overlays label {
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;
  padding: 4px 0 !important;
  cursor: pointer !important;
  font-size: 13px !important;
}

.leaflet-control-layers-overlays label span {
  display: flex;
  align-items: center;
}

.leaflet-control-layers-separator {
  margin: 6px 0 !important;
  border-top: 1px solid #e5e7eb !important;
}

/* Dark mode layer control */
@media (prefers-color-scheme: dark) {
  .leaflet-control-layers {
    background: #374151 !important;
    color: #f9fafb !important;
    border: 1px solid #4b5563 !important;
  }

  .leaflet-control-layers-separator {
    border-top-color: #4b5563 !important;
  }

  .leaflet-control-layers-overlays label {
    color: #f9fafb !important;
  }
}

/* Start/End marker styling */
.start-end-marker {
  z-index: 600 !important;
}

/* ================================
   Accessibility: Reduced Motion Support
   ================================ */
@media (prefers-reduced-motion: reduce) {
  .custom-highlighted-marker div,
  .pulse-animation {
    animation: none !important;
  }

  .travel-marker-interactive:focus-visible .travel-marker-visual {
    transform: none;
  }
}

/* ================================
   Accessibility: High Contrast Support
   ================================ */
@media (prefers-contrast: more) {
  :root {
    --travel-marker-color-past: #1a3a6c;
    --travel-marker-color-present: #0d6b5c;
    --travel-marker-color-future: #c45a1a;
  }

  .travel-marker-icon path {
    stroke: #000 !important;
    stroke-width: 3 !important;
  }

  .travel-marker-interactive:focus-visible {
    outline: 4px solid #000;
    outline-offset: 3px;
    box-shadow: none;
  }

  .temporal-symbol circle,
  .temporal-symbol path {
    stroke-width: 1.2 !important;
  }
}

@media (prefers-color-scheme: dark) and (prefers-contrast: more) {
  :root {
    --travel-marker-color-past: #7ba3d8;
    --travel-marker-color-present: #5fd8c4;
    --travel-marker-color-future: #ffa86a;
  }

  .travel-marker-icon path {
    stroke: #fff !important;
  }

  .travel-marker-interactive:focus-visible {
    outline-color: #fff;
  }
}

/* ================================
   Accessibility: Touch Target Enhancement (44x44px minimum)
   ================================ */
@media (pointer: coarse) {
  .travel-marker-interactive {
    position: relative;
  }

  .travel-marker-interactive::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 44px;
    height: 44px;
    transform: translate(-50%, -50%);
    background: transparent;
  }
}
